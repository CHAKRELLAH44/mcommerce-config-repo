# CONFIGURATION GENERALE
server.port=9002
spring.application.name=microservice-commandes


# ========================================
# PROPRIÉTÉ PERSONNALISÉE - COMMANDES RÉCENTES
# ========================================
# Cette propriété permet d'afficher les commandes reçues 
# durant les N derniers jours
# Valeur par défaut : 10 jours
# Pour modifier à chaud : changer cette valeur, commit sur GitHub,
# puis appeler POST http://localhost:9002/actuator/refresh
mes-config-ms.commandes-last=2

# ========================================
# CONFIGURATION FEIGN CLIENT
# ========================================
# Timeout pour les appels Feign vers microservice-produits
# Valeurs en millisecondes
feign.client.config.default.connectTimeout=5000
feign.client.config.default.readTimeout=10000

# ========================================
# CONFIGURATION RESILIENCE4J - CIRCUIT BREAKER
# ========================================
# Configuration du circuit breaker pour protéger les appels
# vers le microservice-produits

# Nombre minimum d'appels avant d'évaluer le taux d'échec
resilience4j.circuitbreaker.instances.productService.minimum-number-of-calls=5

# Seuil de taux d'échec pour ouvrir le circuit (en %)
resilience4j.circuitbreaker.instances.productService.failure-rate-threshold=50

# Durée d'attente en état ouvert avant de passer en half-open (ms)
resilience4j.circuitbreaker.instances.productService.wait-duration-in-open-state=10000

# Nombre d'appels permis en état half-open
resilience4j.circuitbreaker.instances.productService.permitted-number-of-calls-in-half-open-state=3

# Taille de la fenêtre glissante pour calculer le taux d'échec
resilience4j.circuitbreaker.instances.productService.sliding-window-size=10

# Type de fenêtre : COUNT_BASED ou TIME_BASED
resilience4j.circuitbreaker.instances.productService.sliding-window-type=COUNT_BASED

# ========================================
# CONFIGURATION ACTUATOR
# ========================================
# Exposition de tous les endpoints Actuator pour la supervision
management.endpoints.web.exposure.include=*
management.endpoint.health.show-details=always

# Activer le endpoint refresh pour le rechargement à chaud
management.endpoint.refresh.enabled=true

# ========================================
# CONFIGURATION LOGGING
# ========================================
# Niveau de log pour le microservice
logging.level.com.mcommerce.microservice_commandes=INFO
logging.level.org.springframework.cloud.openfeign=DEBUG
logging.level.io.github.resilience4j=DEBUG

# ========================================
# CONFIGURATION JPA/HIBERNATE
# ========================================
# Afficher les requêtes SQL dans les logs
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.format_sql=true

# ========================================
# CONFIGURATION EUREKA
# ========================================
# Heartbeats pour la détection rapide des pannes
eureka.instance.lease-renewal-interval-in-seconds=5
eureka.instance.lease-expiration-duration-in-seconds=15

# ========================================
# NOTES D'UTILISATION
# ========================================
# Pour modifier la valeur de commandes-last de 10 à 20 :
# 1. Modifier mes-config-ms.commandes-last=20 dans ce fichier
# 2. Commit et push sur GitHub
# 3. Appeler : POST http://localhost:9002/actuator/refresh
# 4. Vérifier : GET http://localhost:9002/config
#
# Pour tester le circuit breaker :
# 1. Arrêter le microservice-produits
# 2. Appeler : GET http://localhost:9002/commandes/1/produit
# 3. Le fallback retournera un produit par défaut
